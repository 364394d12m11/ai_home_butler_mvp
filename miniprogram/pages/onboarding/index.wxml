<view class="page">
  <!-- 头部 -->
  <view class="header">
    <view class="main-title">AI家庭管家 V5.3</view>
    <view class="subtitle">让我了解你的家庭</view>
  </view>

  <!-- 内容区 -->
  <view class="step-content">
    
    <!-- 城市位置 -->
    <view class="card compact">
      <view class="section-title">📍 城市位置</view>
      
      <view wx:if="{{locationStatus === 'pending'}}" class="location-status pending">
        <text class="status-icon">🔄</text>
        <text class="status-text">定位中...</text>
      </view>
      
      <view wx:elif="{{locationStatus === 'success'}}" class="location-status success">
        <view class="location-info">
          <text class="location-name">
            {{form.city.province || ''}}{{form.city.city || ''}}{{form.city.district || ''}}
          </text>
        </view>
        <text wx:if="{{form.autoLocation}}" class="location-tip">自动定位，如不对请点击下方更改</text>
      </view>
      
      <view wx:elif="{{locationStatus === 'failed'}}" class="location-status failed">
        <text class="status-icon">⚠️</text>
        <text class="status-text">定位失败，请手动选择</text>
      </view>
      
      <picker mode="region" bindchange="onRegion" class="region-picker-compact">
        <view class="picker-btn-compact">
          <text class="picker-label">{{locationStatus === 'success' ? '重新选择' : '选择城市'}}</text>
          <text class="picker-arrow">›</text>
        </view>
      </picker>
    </view>

    <!-- 家庭成员结构 -->
    <view class="card">
      <view class="section-title">👥 家庭成员</view>
      <view class="family-grid">
        <view class="family-card {{form.familyType === 'single' ? 'active' : ''}}" 
              bindtap="onFamilyTypeSelect" data-value="single">
          <view class="family-emoji">🧑</view>
          <view class="family-text">单身</view>
        </view>
        <view class="family-card {{form.familyType === 'couple' ? 'active' : ''}}" 
              bindtap="onFamilyTypeSelect" data-value="couple">
          <view class="family-emoji">👫</view>
          <view class="family-text">夫妻二人</view>
        </view>
        <view class="family-card {{form.familyType === 'hasChild' ? 'active' : ''}}" 
              bindtap="onFamilyTypeSelect" data-value="hasChild">
          <view class="family-emoji">👨‍👩‍👧‍👦</view>
          <view class="family-text">有孩子</view>
        </view>
      </view>
      
      <!-- 单身：选择性别 -->
      <view wx:if="{{form.familyType === 'single'}}" class="sub-options">
        <view class="sub-title">性别</view>
        <view class="gender-options">
          <view class="option-btn {{form.gender === 'male' ? 'active' : ''}}" 
                bindtap="onGenderSelect" data-value="male">男</view>
          <view class="option-btn {{form.gender === 'female' ? 'active' : ''}}" 
                bindtap="onGenderSelect" data-value="female">女</view>
        </view>
      </view>
      
      <!-- 有孩子：数量和年龄 -->
      <view wx:if="{{form.familyType === 'hasChild'}}" class="sub-options">
        <view class="sub-title">孩子数量</view>
        <view class="count-options">
          <view class="option-btn {{form.childCount === 1 ? 'active' : ''}}" 
                bindtap="onChildCountSelect" data-value="1">1个</view>
          <view class="option-btn {{form.childCount === 2 ? 'active' : ''}}" 
                bindtap="onChildCountSelect" data-value="2">2个</view>
          <view class="option-btn {{form.childCount === 3 ? 'active' : ''}}" 
                bindtap="onChildCountSelect" data-value="3">3个</view>
          <view class="option-btn {{form.childCount === 4 ? 'active' : ''}}" 
                bindtap="onChildCountSelect" data-value="4">4个</view>
        </view>
        
        <!-- 孩子年龄滚动选择 -->
        <view wx:if="{{form.childCount > 0}}" class="children-details">
          <view wx:for="{{form.childrenInfo}}" wx:key="index" class="child-item">
            <view class="child-header">第{{index + 1}}个孩子</view>
            
            <view class="age-picker-container">
              <view class="age-display">
                年龄：{{item.years}}岁{{item.years <= 2 ? (item.months || 0) + '个月' : ''}}
              </view>
              
              <picker-view indicator-style="height: 50px;" 
                          style="width: 100%; height: 120px;" 
                          value="{{[item.years, item.years <= 2 ? (item.months || 1) - 1 : 0]}}"
                          bindchange="onChildAgeChange" 
                          data-index="{{index}}">
                <picker-view-column>
                  <view wx:for="{{childAgeOptions.years}}" wx:key="*this" class="picker-item">
                    {{item}}岁
                  </view>
                </picker-view-column>
                <picker-view-column wx:if="{{item.years <= 2}}">
                  <view wx:for="{{childAgeOptions.months}}" wx:key="*this" class="picker-item">
                    {{item}}个月
                  </view>
                </picker-view-column>
              </picker-view>
            </view>
            
            <!-- 性别选择 -->
            <view class="child-gender">
              <text class="gender-label">性别：</text>
              <view class="gender-options">
                <text class="gender-btn {{item.gender === 'boy' ? 'active' : ''}}"
                      bindtap="onChildGenderSelect" 
                      data-index="{{index}}" 
                      data-value="boy">男孩</text>
                <text class="gender-btn {{item.gender === 'girl' ? 'active' : ''}}"
                      bindtap="onChildGenderSelect" 
                      data-index="{{index}}" 
                      data-value="girl">女孩</text>
                <text class="gender-btn {{item.gender === 'skip' ? 'active' : ''}}"
                      bindtap="onChildGenderSelect" 
                      data-index="{{index}}" 
                      data-value="skip">跳过</text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- 家庭帮手 -->
    <view class="card">
      <view class="section-title">👨‍🔧 工作人员</view>
      
      <view class="helper-list">
        <!-- 保姆 -->
        <view class="helper-item">
          <view class="helper-main">
            <view class="helper-info">
              <view class="helper-emoji">👩‍🍳</view>
              <text class="helper-name">保姆</text>
            </view>
            <switch checked="{{form.helpers.nanny.enabled}}" 
                   bindchange="onHelperToggle" 
                   data-type="nanny"/>
          </view>
          
          <view wx:if="{{form.helpers.nanny.enabled}}" class="helper-details">
            <view class="detail-row">
              <text class="detail-label required">数量：</text>
              <view class="count-options">
                <text class="option-btn {{form.helpers.nanny.count === 1 ? 'active' : ''}}"
                      bindtap="onHelperCountSelect" data-type="nanny" data-value="1">1个</text>
                <text class="option-btn {{form.helpers.nanny.count === 2 ? 'active' : ''}}"
                      bindtap="onHelperCountSelect" data-type="nanny" data-value="2">2个</text>
                <text class="option-btn {{form.helpers.nanny.count === 3 ? 'active' : ''}}"
                      bindtap="onHelperCountSelect" data-type="nanny" data-value="3">3个</text>
                <text class="option-btn {{form.helpers.nanny.count === 4 ? 'active' : ''}}"
                      bindtap="onHelperCountSelect" data-type="nanny" data-value="4">4个</text>
              </view>
            </view>
          </view>
        </view>
        
        <!-- 钟点工 -->
        <view class="helper-item">
          <view class="helper-main">
            <view class="helper-info">
              <view class="helper-emoji">🧹</view>
              <text class="helper-name">钟点工</text>
            </view>
            <switch checked="{{form.helpers.cleaner.enabled}}" 
                   bindchange="onHelperToggle" 
                   data-type="cleaner"/>
          </view>
          
          <view wx:if="{{form.helpers.cleaner.enabled}}" class="helper-details">
            <view class="detail-row">
              <text class="detail-label required">数量：</text>
              <view class="count-options">
                <text class="option-btn {{form.helpers.cleaner.count === 1 ? 'active' : ''}}"
                      bindtap="onHelperCountSelect" data-type="cleaner" data-value="1">1个</text>
                <text class="option-btn {{form.helpers.cleaner.count === 2 ? 'active' : ''}}"
                      bindtap="onHelperCountSelect" data-type="cleaner" data-value="2">2个</text>
                <text class="option-btn {{form.helpers.cleaner.count === 3 ? 'active' : ''}}"
                      bindtap="onHelperCountSelect" data-type="cleaner" data-value="3">3个</text>
                <text class="option-btn {{form.helpers.cleaner.count === 4 ? 'active' : ''}}"
                      bindtap="onHelperCountSelect" data-type="cleaner" data-value="4">4个</text>
              </view>
            </view>
            
            <view class="detail-row">
              <text class="detail-label">出勤频率：</text>
              <view class="freq-options">
                <text wx:for="{{cleanerFrequencies}}" wx:key="*this"
                      class="option-btn {{form.helpers.cleaner.frequency === item ? 'active' : ''}}"
                      bindtap="onHelperFreqSelect" data-type="cleaner" data-value="{{item}}">{{item}}</text>
              </view>
            </view>
          </view>
        </view>
        
        <!-- 司机 -->
        <view class="helper-item">
          <view class="helper-main">
            <view class="helper-info">
              <view class="helper-emoji">🚗</view>
              <text class="helper-name">司机</text>
            </view>
            <switch checked="{{form.helpers.driver.enabled}}" 
                   bindchange="onHelperToggle" 
                   data-type="driver"/>
          </view>
          
          <view wx:if="{{form.helpers.driver.enabled}}" class="helper-details">
            <view class="detail-row">
              <text class="detail-label required">数量：</text>
              <view class="count-options">
                <text class="option-btn {{form.helpers.driver.count === 1 ? 'active' : ''}}"
                      bindtap="onHelperCountSelect" data-type="driver" data-value="1">1个</text>
                <text class="option-btn {{form.helpers.driver.count === 2 ? 'active' : ''}}"
                      bindtap="onHelperCountSelect" data-type="driver" data-value="2">2个</text>
                <text class="option-btn {{form.helpers.driver.count === 3 ? 'active' : ''}}"
                      bindtap="onHelperCountSelect" data-type="driver" data-value="3">3个</text>
                <text class="option-btn {{form.helpers.driver.count === 4 ? 'active' : ''}}"
                      bindtap="onHelperCountSelect" data-type="driver" data-value="4">4个</text>
              </view>
            </view>
          </view>
        </view>
        
        <!-- 自己搞定一切 -->
        <view class="helper-item">
          <view class="helper-main">
            <view class="helper-info">
              <view class="helper-emoji">✋</view>
              <text class="helper-name">自己搞定一切</text>
            </view>
            <switch checked="{{!hasAnyHelper}}" 
                   disabled="{{hasAnyHelper}}"
                   bindchange="onHelperToggle" 
                   data-type="selfHandle"/>
          </view>
        </view>
      </view>
    </view>

    <!-- AI语气偏好 -->
    <view class="card">
      <view class="section-title">🤖 AI语气偏好</view>
      <view class="tone-list">
        <view class="tone-card {{form.aiTone === '温柔陪伴' ? 'active' : ''}}"
              bindtap="onAiToneSelect" data-value="温柔陪伴">
          <view class="tone-title">温柔陪伴</view>
          <view class="tone-sample">"慢一点，生活会更好。"</view>
        </view>
        <view class="tone-card {{form.aiTone === '干练高效' ? 'active' : ''}}"
              bindtap="onAiToneSelect" data-value="干练高效">
          <view class="tone-title">干练高效</view>
          <view class="tone-sample">"3道菜，30分钟搞定。"</view>
        </view>
        <view class="tone-card {{form.aiTone === '幽默轻松' ? 'active' : ''}}"
              bindtap="onAiToneSelect" data-value="幽默轻松">
          <view class="tone-title">幽默轻松</view>
          <view class="tone-sample">"今天吃得健康，快乐加倍。"</view>
        </view>
      </view>
    </view>

  </view>

  <!-- 底部按钮 -->
  <view class="bottom-actions">
    <button class="btn-primary" bindtap="onDone">🎉 进入</button>
  </view>
</view>