<!-- miniprogram/pages/reports/index.wxml - V3.0 ä¸‰æ ‡ç­¾é¡µç‰ˆ -->
<view class="page">
  
  <!-- æ ‡ç­¾é¡µåˆ‡æ¢å™¨ -->
  <view class="tabs-header">
    <view class="tab-item {{currentTab === 'week' ? 'active' : ''}}" 
          bindtap="switchTab" data-tab="week">
      <text class="tab-text">å‘¨æŠ¥</text>
    </view>
    <view class="tab-item {{currentTab === 'dimensions' ? 'active' : ''}}" 
          bindtap="switchTab" data-tab="dimensions">
      <text class="tab-text">å®¶åº­ç”»åƒ</text>
    </view>
    <view class="tab-item {{currentTab === 'trends' ? 'active' : ''}}" 
          bindtap="switchTab" data-tab="trends">
      <text class="tab-text">è¶‹åŠ¿åˆ†æ</text>
    </view>
    <view class="tab-item {{currentTab === 'reflection' ? 'active' : ''}}" 
      bindtap="switchTab" data-tab="reflection">
  <text class="tab-text">æ¯æ—¥å¤ç›˜</text>
</view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading">
    <text class="loading-text">åˆ†æä¸­...</text>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view wx:elif="{{empty}}" class="empty">
    <text class="empty-text">æš‚æ— æ•°æ®</text>
    <button bindtap="regen" class="btn-primary">ç”ŸæˆæŠ¥å‘Š</button>
  </view>

  <!-- å‘¨æŠ¥å†…å®¹ -->
  <view wx:elif="{{currentTab === 'week' && week}}" class="content">
    <!-- é¡¶éƒ¨ï¼šæ—¶é—´èŒƒå›´ -->
    <view class="header">
      <view class="title">æœ¬å‘¨æŠ¥å‘Š</view>
      <view class="range">{{week.span.start}} ï½ {{week.span.end}}</view>
    </view>

    <!-- KPI ä¸‰å¡ -->
    <view class="kpis">
      <view class="kpi-card">
        <view class="kpi-label">å­¦ä¹ æŒ‰æ—¶ç‡</view>
        <view class="kpi-value">{{week.kpisView.studyOnTimePct}}%</view>
      </view>
      <view class="kpi-card">
        <view class="kpi-label">å®¶åŠ¡è¾¾æˆç‡</view>
        <view class="kpi-value">{{week.kpisView.choresDonePct}}%</view>
      </view>
      <view class="kpi-card">
        <view class="kpi-label">èœå•ç‚¹å‡»</view>
        <view class="kpi-value">{{week.kpisView.dietClicks}}</view>
      </view>
    </view>

    <!-- æœ¬å‘¨å»ºè®® Top3 -->
    <view class="section">
      <view class="section-title">æœ¬å‘¨å»ºè®®ï¼ˆTop 3ï¼‰</view>
      <view class="suggestions">
        <view class="suggestion-item" wx:for="{{week.suggestions}}" wx:key="*this">
          <text class="suggestion-text">â€¢ {{item}}</text>
        </view>
      </view>
    </view>

    <!-- æ“ä½œ -->
    <view class="actions">
      <button bindtap="regen" class="btn-secondary">é‡æ–°ç”Ÿæˆ</button>
    </view>
  </view>

  <!-- å…­ç»´ç”»åƒå†…å®¹ -->
  <view wx:elif="{{currentTab === 'dimensions' && sixDimensions}}" class="content">
    
    <!-- æ•´ä½“æ¦‚è§ˆ -->
    <view class="overview-card">
      <view class="overview-header">
        <text class="overview-title">å®¶åº­ç”»åƒæ¦‚è§ˆ</text>
        <view class="overall-score">
          <text class="score-number">{{sixDimensions.overall.score}}</text>
          <text class="score-label">ç»¼åˆå¾—åˆ†</text>
        </view>
      </view>
      <view class="overview-meta">
        <text class="balance-text">å‘å±•çŠ¶æ€ï¼š{{sixDimensions.overall.balance}}</text>
        <text class="level-badge {{sixDimensions.overall.level === 'ä¼˜ç§€' ? 'excellent' : sixDimensions.overall.level === 'è‰¯å¥½' ? 'good' : 'normal'}}">
          {{sixDimensions.overall.level}}
        </text>
      </view>
    </view>

    <!-- å…­ç»´è¯¦ç»†åˆ†æ -->
    <view class="dimensions-analysis">
      <view class="section-title">å„ç»´åº¦åˆ†æ</view>
      
      <view class="dimension-card" wx:for="{{sixDimensions.dimensions}}" wx:key="key">
        <view class="dimension-header">
          <view class="dimension-left">
            <text class="dimension-emoji">{{item.emoji}}</text>
            <view class="dimension-info">
              <text class="dimension-name">{{item.name}}</text>
              <text class="dimension-desc">{{item.desc}}</text>
            </view>
          </view>
          <view class="dimension-right">
            <text class="dimension-score">{{item.score}}</text>
            <text class="dimension-level {{item.level === 'ä¼˜ç§€' ? 'excellent' : item.level === 'è‰¯å¥½' ? 'good' : 'normal'}}">
              {{item.level}}
            </text>
          </view>
        </view>
        
        <!-- æ´å¯Ÿ -->
        <view class="dimension-insights" wx:if="{{item.insights.length > 0}}">
          <view class="insights-title">æ´å¯Ÿï¼š</view>
          <view class="insights-list">
            <text class="insight-item" wx:for="{{item.insights}}" wx:key="*this">{{item}}</text>
          </view>
        </view>
        
        <!-- è¡ŒåŠ¨å»ºè®® -->
        <view class="dimension-actions" wx:if="{{item.actions.length > 0}}">
          <view class="actions-title">å»ºè®®ï¼š</view>
          <view class="actions-list">
            <text class="action-item" wx:for="{{item.actions}}" wx:key="*this">â€¢ {{item}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- æ•´ä½“æ´å¯Ÿ -->
    <view class="insights-section" wx:if="{{sixDimensions.insights.length > 0}}">
      <view class="section-title">æ•´ä½“æ´å¯Ÿ</view>
      <view class="insights-card">
        <view class="insight-item" wx:for="{{sixDimensions.insights}}" wx:key="*this">
          <text class="insight-icon">ğŸ’¡</text>
          <text class="insight-text">{{item}}</text>
        </view>
      </view>
    </view>

    <!-- æ”¹è¿›å»ºè®® -->
    <view class="recommendations-section" wx:if="{{sixDimensions.recommendations.length > 0}}">
      <view class="section-title">æ”¹è¿›æ–¹å‘</view>
      <view class="recommendations-list">
        <view class="recommendation-card" wx:for="{{sixDimensions.recommendations}}" wx:key="title">
          <view class="rec-header">
            <text class="rec-priority {{item.priority === 'high' ? 'high' : item.priority === 'medium' ? 'medium' : 'low'}}">
              {{item.priority === 'high' ? 'é‡è¦' : item.priority === 'medium' ? 'ä¸­ç­‰' : 'ä¸€èˆ¬'}}
            </text>
            <text class="rec-title">{{item.title}}</text>
          </view>
          <view class="rec-items">
            <text class="rec-item" wx:for="{{item.items}}" wx:key="*this">â€¢ {{item}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- è¶‹åŠ¿åˆ†æå†…å®¹ -->
  <view wx:elif="{{currentTab === 'trends' && trendsData}}" class="content">
    
    <!-- ä½¿ç”¨ç»Ÿè®¡ -->
    <view class="usage-section">
      <view class="section-title">ä½¿ç”¨ç»Ÿè®¡</view>
      <view class="usage-cards">
        <view class="usage-card">
          <text class="usage-number">{{trendsData.usage.totalDays}}</text>
          <text class="usage-label">æ´»è·ƒå¤©æ•°</text>
        </view>
        <view class="usage-card">
          <text class="usage-number">{{trendsData.usage.menuGenerations}}</text>
          <text class="usage-label">èœå•ç”Ÿæˆ</text>
        </view>
        <view class="usage-card">
          <text class="usage-number">{{trendsData.usage.averagePerWeek}}</text>
          <text class="usage-label">å‘¨å‡ä½¿ç”¨</text>
        </view>
      </view>
    </view>

    <!-- åå¥½åˆ†æ -->
    <view class="preferences-section">
      <view class="section-title">åå¥½è¶‹åŠ¿</view>
      
      <view class="preference-item">
        <view class="pref-label">é¥®é£Ÿç›®æ ‡åå¥½ï¼š</view>
        <view class="pref-tags">
          <text class="pref-tag" wx:for="{{trendsData.preferences.favoriteGoals}}" wx:key="*this">{{item}}</text>
        </view>
      </view>
      
      <view class="preference-item">
        <view class="pref-label">å®¶åº­åŠ©æ‰‹é…ç½®ï¼š</view>
        <text class="pref-value">{{trendsData.preferences.helpersUtilization}}</text>
      </view>
      
      <view class="preference-item">
        <view class="pref-label">é¢„ç®—åå¥½ï¼š</view>
        <text class="pref-value">{{trendsData.preferences.budgetTrend}}</text>
      </view>
    </view>

    <!-- è¶‹åŠ¿æ´å¯Ÿ -->
    <view class="trends-insights">
      <view class="section-title">è¶‹åŠ¿æ´å¯Ÿ</view>
      <view class="insights-card">
        <view class="insight-item" wx:for="{{trendsData.insights}}" wx:key="*this">
          <text class="insight-icon">ğŸ“ˆ</text>
          <text class="insight-text">{{item}}</text>
        </view>
      </view>
    </view>
  </view>

</view>