<!-- pages/home/index.wxml - V3.1 æ°”è´¨å‡çº§ç‰ˆ -->
<view class="page {{weatherTheme.baseClass}} {{weatherTheme.type}}" style="background: {{weatherTheme.bg}};">

<!-- å¤©æ°”åŠ¨ç”»å±‚ - æç®€ç‰ˆ -->
<view class="weather-animations">
  
<!-- é›¨æ»´/é›ªèŠ±/å†°é›¹ -->
<view class="raindrops" wx:if="{{raindrops.length > 0 && enableAnimations}}">
  <view
    wx:for="{{raindrops}}"
    wx:key="*this"
    class="{{ item.isSnow ? 'snowflake-light' : 'raindrop-light' }}"
    style="left: {{item.left + '%'}}; animation-delay: {{item.delay + 'ms'}}; animation-duration: {{item.duration + 'ms'}}; width: {{(item.size || item.w || 2) + 'rpx'}}; height: {{(item.size || item.h || 22) + 'rpx'}}; opacity: {{item.opacity || 0.6}};">
  </view>
</view>

  <!-- å¤œç©ºå±‚ï¼ˆåŒ…å«æœˆäº®+äº‘+æ˜Ÿæ˜Ÿï¼‰ -->
  <view
    class="celestial-layer"
    wx:if="{{enableAnimations && (weatherTheme.showMoon || nightClouds.length > 0)}}"
  >
    <view class="moon-wrapper" wx:if="{{weatherTheme.showMoon}}">
      <view class="moon-glow"></view>
      <view class="moon-core"></view>
    </view>

    <view class="night-cloud-layer" wx:if="{{nightClouds.length > 0}}">
      <view
        class="night-cloud"
        wx:for="{{nightClouds}}"
        wx:key="index"
        style="left: {{item.left + '%'}}; top: {{item.top + '%'}}; width: {{item.width + 'rpx'}}; height: {{item.height + 'rpx'}}; opacity: {{item.opacity}}; animation-duration: {{item.duration + 'ms'}}; animation-delay: {{item.delay + 'ms'}};"
      ></view>
    </view>
  </view>

  <!-- æ˜Ÿæ˜Ÿï¼ˆä»…å¤œæ™šï¼‰ -->
  <view class="stars" wx:if="{{stars.length > 0 && enableAnimations}}">
    <view class="star-light" 
      wx:for="{{stars}}" 
      wx:key="*this"
      style="left: {{item.left + '%'}}; top: {{item.top + '%'}}; animation-delay: {{item.delay + 'ms'}}; opacity: {{item.opacity}};">
    </view>
  </view>
</view>
  
  <!-- AIé—®å€™è¯­ - é¡¶éƒ¨è½»ç›ˆæ ·å¼ -->
  <view class="ai-greeting-top" wx:if="{{aiGreeting}}">
    <text class="greeting-text">"{{aiGreeting}}"</text>
  </view>

<!-- å¤©æ°”æ ¸å¿ƒä¿¡æ¯ - ä¸­å¿ƒç„¦ç‚¹ -->
<view class="weather-hero">
  <view class="hero-main">
    <view class="temp-line">
      <image class="weather-icon" src="{{weatherIconUrl}}" mode="aspectFit" />
      <text class="hero-temp">{{weather.now.temp || '--'}}Â°</text>
    </view>

    <text class="hero-desc">{{weather.now.text || 'è·å–ä¸­'}}</text>
    <text class="hero-temp-range">æœ€é«˜ {{weather.daily.max}}Â° æœ€ä½ {{weather.daily.min}}Â°</text>

    <!-- âœ… æ¢å¤ä½ç½®è¡Œ -->
    <view class="hero-location">
      <text class="location-icon">â€¢</text>
      <text class="location-text">{{cityName}}</text>
    </view>
  </view>
</view>

  <!-- æ—¥æœŸä¸èŠ‚æ°”ä¿¡æ¯ -->
  <view class="date-info-card">
  <view class="date-row">
    <text class="date-text">{{dateYmd}}</text>
    <text class="weekday-text">{{weekday}}</text>
    <text class="lunar-text" wx:if="{{lunar.lunarDate}}">{{lunar.lunarDate}}</text>
  </view>
  
  <view class="solar-term-tag" wx:if="{{solarTerm && solarTerm.name}}">
    <text class="term-name">{{solarTerm.name}}</text>
  </view>
</view>

<!-- ä»Šæ—¥é¤å•å¡ç‰‡ - ç»ç’ƒæ‹Ÿæ€ -->
<view class="glass-card meal-card" bindtap="goDiet">
  <view class="card-header">
    <view class="header-left">
      <text class="card-emoji">ğŸ±</text>
      <text class="card-title">ä»Šæ—¥é¤å•</text>
    </view>
    <text class="card-arrow">â€º</text>
  </view>
  
  <view class="meal-preview" wx:if="{{todayMenu.length > 0}}">
    <view class="meal-simple-list">
      <text class="meal-dish-name" wx:for="{{todayMenu}}" wx:key="id">
        {{item.name}}
      </text>
    </view>
    
    <view class="meal-explain" wx:if="{{mealExplain}}">
      <text class="explain-icon">ğŸ’­</text>
      <text class="explain-text">{{mealExplain}}</text>
    </view>
  </view>
  
  <view class="meal-placeholder" wx:else>
    <text class="placeholder-icon">ğŸ½ï¸</text>
    <text class="placeholder-text">è½»è§¦ç”Ÿæˆä»Šæ—¥èœå•</text>
  </view>
</view>

  <!-- ä»Šæ—¥ä»»åŠ¡å¡ç‰‡ - ç»ç’ƒæ‹Ÿæ€ -->
  <view class="glass-card tasks-card">
    <view class="card-header">
      <view class="header-left">
        <text class="card-emoji">âœ“</text>
        <text class="card-title">ä»Šæ—¥ä»»åŠ¡</text>
      </view>
    </view>
    
    <view class="task-list">
      <view class="task-item" bindtap="goChores">
        <text class="task-icon">ğŸ§¹</text>
        <view class="task-content">
          <text class="task-title">å®¶åŠ¡ç®¡ç†</text>
          <text class="task-desc" wx:if="{{helpersV3.length > 0}}">{{helpersV3[0].type}}ååŠ©æ—¥</text>
          <text class="task-desc" wx:else>æ—¥å¸¸æ¸…ç†</text>
        </view>
        <text class="task-arrow">â€º</text>
      </view>

      <view class="task-item" bindtap="goStudy" wx:if="{{profile.total_members > 2 || profile.has_child}}">
        <text class="task-icon">ğŸ“š</text>
        <view class="task-content">
          <text class="task-title">å­¦ä¹ å®‰æ’</text>
          <text class="task-desc">é˜…è¯» 20min</text>
        </view>
        <text class="task-arrow">â€º</text>
      </view>

      <view class="task-item" wx:if="{{weather.now.temp < 15}}">
        <text class="task-icon">ğŸ’§</text>
        <view class="task-content">
          <text class="task-title">å¥åº·æé†’</text>
          <text class="task-desc">å¤©å†·æ³¨æ„ä¿æš–ï¼Œå¤šå–æ¸©æ°´</text>
        </view>
      </view>

      <view class="task-item highlight" bindtap="showPeopleAdjuster" wx:if="{{activeOverrides.length > 0}}">
        <text class="task-icon">ğŸ‘¥</text>
        <view class="task-content">
          <text class="task-title">{{activeOverrides[0].reason}}å®‰æ’</text>
          <text class="task-desc">å½“å‰{{currentPeople}}äººç”¨é¤</text>
        </view>
        <text class="task-arrow">â€º</text>
      </view>
    </view>
  </view>

  <!-- AIä¼˜åŒ–æç¤º -->
  <view class="ai-badge" wx:if="{{userDataV3.isV3}}">
    <text class="badge-icon">ğŸƒ</text>
    <text class="badge-text">AI å·²ä¼˜åŒ–</text>
  </view>

  <!-- äº‹ä»¶æé†’ -->
  <view class="glass-card events-card" wx:if="{{events.length > 0}}">
    <view class="card-header">
      <view class="header-left">
        <text class="card-emoji">ğŸ“…</text>
        <text class="card-title">è¿‘æœŸå®‰æ’</text>
      </view>
      <text class="event-badge">{{events.length}}</text>
    </view>
    
    <view class="events-list">
      <view class="event-item" wx:for="{{events}}" wx:key="_id" wx:if="{{index < 2}}">
        <text class="event-date">{{item.time}}</text>
        <text class="event-title">{{item.title}}</text>
        <view class="event-pin" wx:if="{{item.pin}}">ğŸ“Œ</view>
      </view>
      
      <view class="more-events" wx:if="{{events.length > 2}}" bindtap="goAddEvent">
        <text class="more-text">è¿˜æœ‰ {{events.length - 2}} é¡¹</text>
        <text class="more-arrow">â€º</text>
      </view>
    </view>
  </view>

<!-- è°ƒè¯•æŒ‰é’® -->
<view class="debug-fab" wx:if="{{__DEV__}}" bindtap="toggleDebug">
  <text>ğŸ› </text>
</view>

<!-- V3.3 å®Œæ•´è°ƒè¯•é¢æ¿ -->
<view class="debug-panel" wx:if="{{showDebugPanel}}">
  <view class="debug-header">
    <text class="debug-title">ğŸ” å¤©æ°”è°ƒè¯•é¢æ¿</text>
    <text class="debug-close" bindtap="toggleDebugPanel">Ã—</text>
  </view>

  <!-- â€¦â€¦ï¼ˆé¢æ¿å†…éƒ¨çš„æ‰€æœ‰ section ä¿æŒä½ ç°åœ¨çš„å†…å®¹ï¼Œä¸å˜ï¼‰â€¦â€¦ -->

  <view class="debug-info">
    <text>å½“å‰ä¸»é¢˜: {{weatherTheme.type || 'default'}}</text>
    <text>æ€§èƒ½æ¨¡å¼: {{performanceMode}}</text>
    <text>åŠ¨ç”»å¯ç”¨: {{enableAnimations ? 'æ˜¯' : 'å¦'}}</text>
  </view>
</view>

<!-- âœ… åªä¿ç•™è¿™ä¸€æšï¼Œå…³é—­æœ€å¤–å±‚ .page -->
</view>
