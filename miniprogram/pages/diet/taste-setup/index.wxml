<view class="page">
  <!-- 头部说明 -->
  <view class="header">
    <text class="title">{{isFirstGenerate ? '首次生成菜单前的设置' : '饮食偏好设置'}}</text>
    <text class="subtitle">AI将根据您的偏好推荐合适的菜品</text>
    <text wx:if="{{isFirstGenerate}}" class="first-tip">⚠️ 首次生成菜单必须完成设置</text>
  </view>

  <!-- 饮食目标 -->
  <view class="section">
    <view class="section-header">
      <text class="section-title">🎯 饮食目标</text>
      <text class="section-desc">成人目标最多3个，儿童目标最多2个</text>
    </view>
    
    <!-- 成人目标 -->
    <view class="subsection-title">成人目标（0-3个）</view>
    <view class="goal-grid">
      <view wx:for="{{dietGoalOptions}}" wx:key="value"
            wx:if="{{item.category === 'adult'}}"
            class="goal-card {{selectedGoals[item.value] ? 'selected' : ''}}"
            bindtap="toggleGoal" 
            data-value="{{item.value}}"
            data-category="{{item.category}}">
        <view class="goal-title">{{item.label}}</view>
        <view class="goal-desc">{{item.desc}}</view>
      </view>
    </view>
    
    <!-- 儿童目标（仅有孩子时显示） -->
    <view wx:if="{{hasKids}}" class="kids-section">
      <view class="subsection-title">儿童目标（0-2个）</view>
      <view class="goal-grid">
        <view wx:for="{{dietGoalOptions}}" wx:key="value"
              wx:if="{{item.category === 'kids'}}"
              class="goal-card {{selectedGoals[item.value] ? 'selected' : ''}}"
              bindtap="toggleGoal" 
              data-value="{{item.value}}"
              data-category="{{item.category}}">
          <view class="goal-title">{{item.label}}</view>
          <view class="goal-desc">{{item.desc}}</view>
        </view>
      </view>
    </view>
  </view>

  <!-- 过敏/禁忌 -->
  <view class="section">
    <view class="section-header">
      <text class="section-title">🚫 过敏/禁忌</text>
      <text class="section-desc">选择需要避免的食材（可选）</text>
    </view>
    <view class="allergy-tags">
      <view wx:for="{{allergyOptions}}" wx:key="value"
            class="allergy-tag {{selectedAllergies[item.value] ? 'selected' : ''}}"
            bindtap="toggleAllergy" 
            data-value="{{item.value}}">
        {{item.label}}
      </view>
    </view>
  </view>

  <!-- 菜系偏好 -->
  <view class="section">
    <view class="section-header">
      <text class="section-title">🌏 菜系偏好（可选）</text>
      <text class="section-desc">最多选3个，影响推荐比例</text>
    </view>
    <view class="cuisine-tags">
      <view wx:for="{{cuisineOptions}}" wx:key="value"
            class="cuisine-tag {{selectedCuisines[item.value] ? 'selected' : ''}}"
            bindtap="toggleCuisine" 
            data-value="{{item.value}}">
        {{item.label}}
      </view>
    </view>
  </view>

  <!-- 预算档次 -->
  <view class="section">
    <view class="section-header">
      <text class="section-title">💰 预算档次</text>
      <text class="section-desc">选择家庭日常饮食的预算水平</text>
    </view>
    <view class="budget-options">
      <view wx:for="{{budgetOptions}}" wx:key="value"
            class="budget-option {{preferences.budget === item.value ? 'selected' : ''}}"
            bindtap="selectBudget" 
            data-value="{{item.value}}">
        <view class="budget-name">{{item.label}}</view>
        <view class="budget-desc">{{item.desc}}</view>
      </view>
    </view>
  </view>

  <!-- 底部按钮 -->
  <view class="bottom-actions">
    <button wx:if="{{!isFirstGenerate}}" class="skip-btn" bindtap="skipSetup">
      稍后设置
    </button>
    <button class="save-btn" bindtap="savePreferences">
      {{isFirstGenerate ? '完成并生成菜单' : '保存设置'}}
    </button>
  </view>
</view>