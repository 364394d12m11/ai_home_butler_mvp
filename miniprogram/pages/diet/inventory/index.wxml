<view class="page">
  <!-- å¤´éƒ¨ç»Ÿè®¡ -->
  <view class="header-stats">
    <view class="stat-card">
      <text class="stat-number">{{totalItems}}</text>
      <text class="stat-label">åº“å­˜å“ç§</text>
    </view>
    <view class="stat-card">
      <text class="stat-number">{{lowStockCount}}</text>
      <text class="stat-label">åº“å­˜ä¸è¶³</text>
    </view>
    <view class="stat-card">
      <text class="stat-number">{{todayExpired}}</text>
      <text class="stat-label">ä»Šæ—¥åˆ°æœŸ</text>
    </view>
  </view>

  <!-- è¶…ä¿å®ˆæé†’åŒºåŸŸ -->
  <view class="alert-section" wx:if="{{conservativeAlerts.length}}">
    <view class="alert-header">
      <text class="alert-title">âš ï¸ åº“å­˜æé†’ (è¶…ä¿å®ˆæ¨¡å¼)</text>
      <text class="confidence-note">ä»…æ˜¾ç¤º â‰¥80% ç½®ä¿¡åº¦çš„æé†’</text>
    </view>
    <view class="alert-list">
      <view class="alert-item confidence-{{item.confidence}}" 
            wx:for="{{conservativeAlerts}}" wx:key="name">
        <view class="alert-content">
          <text class="alert-name">{{item.name}}</text>
          <text class="alert-message">{{item.message}}</text>
          <text class="alert-confidence">ç½®ä¿¡åº¦: {{item.confidence}}%</text>
        </view>
        <view class="alert-actions">
          <button class="alert-btn ignore" bindtap="ignoreAlert" data-item="{{item}}">
            å¿½ç•¥14å¤©
          </button>
          <button class="alert-btn add" bindtap="addToShoppingFromAlert" data-item="{{item}}">
            åŠ å…¥é‡‡è´­
          </button>
        </view>
      </view>
    </view>
  </view>

  <!-- å¿«é€Ÿæ“ä½œ -->
  <view class="quick-actions">
    <button class="action-btn primary" bindtap="quickAddItem">
      ğŸ“¦ å¿«é€Ÿå…¥åº“
    </button>
    <button class="action-btn secondary" bindtap="scanBarcode">
      ğŸ“· æ‰«ç å…¥åº“
    </button>
    <button class="action-btn tertiary" bindtap="voiceAddItem">
      ğŸ¤ è¯­éŸ³å…¥åº“
    </button>
  </view>

  <!-- åº“å­˜åˆ†ç±»å±•ç¤º -->
  <view class="inventory-categories">
    <view class="category-tabs">
      <view class="category-tab {{activeCategory=='all'?'active':''}}" 
            bindtap="switchCategory" data-category="all">
        å…¨éƒ¨ ({{totalItems}})
      </view>
      <view class="category-tab {{activeCategory==item.key?'active':''}}" 
            wx:for="{{categories}}" wx:key="key"
            bindtap="switchCategory" data-category="{{item.key}}">
        {{item.name}} ({{item.count}})
      </view>
    </view>

    <view class="category-content">
      <!-- æœç´¢æ¡† -->
      <view class="search-section">
        <view class="search-box">
          <text class="search-icon">ğŸ”</text>
          <input class="search-input" placeholder="æœç´¢åº“å­˜ç‰©å“" 
                 value="{{searchKeyword}}" bindinput="onSearchInput"/>
        </view>
        <view class="filter-options" wx:if="{{searchKeyword}}">
          <text class="filter-tip">æŒ‰åˆ«åæœç´¢: </text>
          <text class="filter-alias" wx:for="{{searchAliases}}" wx:key="*this"
                bindtap="selectAlias" data-alias="{{item}}">{{item}}</text>
        </view>
      </view>

      <!-- åº“å­˜åˆ—è¡¨ -->
      <view class="inventory-list">
        <view class="inventory-item {{item.status}}" 
              wx:for="{{filteredInventory}}" wx:key="name">
          <view class="item-header">
            <view class="item-info">
              <text class="item-name">{{item.name}}</text>
              <text class="item-aliases" wx:if="{{item.aliases.length}}">
                åˆ«å: {{item.aliases.join('ã€')}}
              </text>
            </view>
            <view class="item-status {{item.status}}">
              <text class="status-text">{{item.statusText}}</text>
            </view>
          </view>

          <view class="item-details">
            <view class="quantity-info">
              <text class="quantity-current">ç°æœ‰: {{item.quantity}}{{item.unit}}</text>
              <text class="quantity-daily" wx:if="{{item.dailyConsumption}}">
                æ—¥è€—: {{item.dailyConsumption}}{{item.unit}}
              </text>
              <text class="quantity-predict" wx:if="{{item.predictedDays}}">
                é¢„è®¡{{item.predictedDays}}å¤©ç”¨å®Œ
              </text>
            </view>
            
            <view class="item-actions">
              <button class="quantity-btn" bindtap="adjustQuantity" 
                      data-item="{{item}}" data-action="decrease">-</button>
              <button class="quantity-btn" bindtap="adjustQuantity" 
                      data-item="{{item}}" data-action="increase">+</button>
              <button class="edit-btn" bindtap="editItem" data-item="{{item}}">ç¼–è¾‘</button>
            </view>
          </view>

          <view class="item-timeline" wx:if="{{item.recentChanges.length}}">
            <text class="timeline-title">æœ€è¿‘å˜åŠ¨:</text>
            <view class="timeline-list">
              <text class="timeline-item" wx:for="{{item.recentChanges}}" wx:key="date">
                {{item.date}} {{item.action}} {{item.quantity}}{{item.unit}}
              </text>
            </view>
          </view>
        </view>
      </view>

      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-state" wx:if="{{!filteredInventory.length}}">
        <text class="empty-icon">ğŸ“¦</text>
        <text class="empty-text">{{searchKeyword ? 'æœªæ‰¾åˆ°ç›¸å…³åº“å­˜' : 'æš‚æ— åº“å­˜è®°å½•'}}</text>
        <button class="empty-action" bindtap="quickAddItem">ç«‹å³æ·»åŠ </button>
      </view>
    </view>
  </view>

  <!-- åº“å­˜è¶‹åŠ¿ -->
  <view class="trend-section" wx:if="{{showTrends}}">
    <view class="trend-header">
      <text class="trend-title">ğŸ“ˆ æ¶ˆè€—è¶‹åŠ¿</text>
      <view class="trend-period">
        <text class="period-option {{trendPeriod=='week'?'active':''}}" 
              bindtap="changeTrendPeriod" data-period="week">æœ¬å‘¨</text>
        <text class="period-option {{trendPeriod=='month'?'active':''}}" 
              bindtap="changeTrendPeriod" data-period="month">æœ¬æœˆ</text>
            </view>
    </view>
    <view class="trend-chart">
      <view class="chart-placeholder">
        <text>æ¶ˆè€—è¶‹åŠ¿å›¾è¡¨åŒºåŸŸ</text>
        <text>({{trendPeriod=='week'?'å‘¨':'æœˆ'}}åº¦æ•°æ®)</text>
      </view>
    </view>
  </view>

  <!-- å¿«é€Ÿå…¥åº“å¼¹çª— -->
  <view class="modal {{showAddModal?'show':''}}" bindtap="closeAddModal">
    <view class="modal-content" catchtap="">
      <view class="modal-header">
        <text class="modal-title">å¿«é€Ÿå…¥åº“</text>
        <text class="close-btn" bindtap="closeAddModal">âœ•</text>
      </view>
      <view class="modal-body">
        <view class="form-group">
          <text class="form-label">ç‰©å“åç§°</text>
          <input class="form-input" placeholder="è¯·è¾“å…¥ç‰©å“åç§°" 
                 value="{{newItem.name}}" bindinput="updateNewItem" data-field="name"/>
        </view>
        <view class="form-group">
          <text class="form-label">æ•°é‡</text>
          <view class="quantity-input">
            <input class="form-input quantity" type="digit" placeholder="0" 
                   value="{{newItem.quantity}}" bindinput="updateNewItem" data-field="quantity"/>
            <picker class="unit-picker" range="{{unitOptions}}" value="{{newItem.unitIndex}}"
                    bindchange="selectUnit">
              <text class="unit-text">{{unitOptions[newItem.unitIndex]}}</text>
            </picker>
          </view>
        </view>
        <view class="form-group">
          <text class="form-label">ä¿è´¨æœŸ (å¯é€‰)</text>
          <picker class="date-picker" mode="date" value="{{newItem.expireDate}}"
                  bindchange="selectExpireDate">
            <text class="date-text">{{newItem.expireDate || 'é€‰æ‹©æ—¥æœŸ'}}</text>
          </picker>
        </view>
        <view class="form-group">
          <text class="form-label">åˆ«å (å¯é€‰)</text>
          <input class="form-input" placeholder="ç”¨é€—å·åˆ†éš”ï¼Œå¦‚: ç•ªèŒ„,æ´‹æŸ¿å­" 
                 value="{{newItem.aliases}}" bindinput="updateNewItem" data-field="aliases"/>
        </view>
      </view>
      <view class="modal-footer">
        <button class="cancel-btn" bindtap="closeAddModal">å–æ¶ˆ</button>
        <button class="confirm-btn" bindtap="confirmAddItem">ç¡®è®¤å…¥åº“</button>
      </view>
    </view>
  </view>
</view>