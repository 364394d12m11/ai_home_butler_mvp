// components/dialog-ai/index.wxml
<view class="dialog-mask" wx:if="{{show}}" bindtap="close">
  <view class="dialog-container" catchtap="">
    
    <!-- å¯¹è¯å†å² -->
    <scroll-view class="messages" scroll-y scroll-into-view="msg-{{messages.length-1}}">
      <view 
        wx:for="{{messages}}" 
        wx:key="index"
        id="msg-{{index}}"
        class="message {{item.role}}">
        <view class="message-content">
          <image wx:if="{{item.meta.type === 'image'}}" src="{{item.meta.url}}" mode="aspectFill" />
          <text wx:else>{{item.content}}</text>
        </view>
      </view>
      
      <view wx:if="{{processing}}" class="message assistant typing">
        <view class="typing-indicator">
          <span></span><span></span><span></span>
        </view>
      </view>
    </scroll-view>
    
    <!-- è¾“å…¥åŒº -->
    <view class="input-area">
      
      <!-- æ¨¡å¼åˆ‡æ¢ -->
      <view class="mode-tabs">
        <view 
          class="mode-tab {{inputMode === 'text' ? 'active' : ''}}"
          data-mode="text"
          bindtap="switchMode">
          æ–‡å­—
        </view>
        <view 
          class="mode-tab {{inputMode === 'voice' ? 'active' : ''}}"
          data-mode="voice"
          bindtap="switchMode">
          è¯­éŸ³
        </view>
        <view 
          class="mode-tab {{inputMode === 'image' ? 'active' : ''}}"
          data-mode="image"
          bindtap="switchMode">
          å›¾ç‰‡
        </view>
      </view>
      
      <!-- æ–‡æœ¬è¾“å…¥ -->
      <view wx:if="{{inputMode === 'text'}}" class="text-input-area">
        <input 
          class="text-input" 
          value="{{inputText}}"
          placeholder="è¯´ç‚¹ä»€ä¹ˆ..."
          bindinput="onInputChange"
          confirm-type="send"
          bindconfirm="sendText"
        />
        <button class="send-btn" bindtap="sendText" disabled="{{!inputText || processing}}">
          å‘é€
        </button>
      </view>
      
      <!-- è¯­éŸ³è¾“å…¥ -->
      <view wx:if="{{inputMode === 'voice'}}" class="voice-input-area">
        <button 
          class="record-btn {{recording ? 'recording' : ''}}"
          bindtouchstart="startRecord"
          bindtouchend="stopRecord">
          <text wx:if="{{!recording}}">æŒ‰ä½è¯´è¯</text>
          <text wx:else>å½•éŸ³ä¸­ {{recordTime}}s</text>
        </button>
      </view>
      
      <!-- å›¾ç‰‡è¾“å…¥ -->
      <view wx:if="{{inputMode === 'image'}}" class="image-input-area">
        <button class="upload-btn" bindtap="chooseImage" disabled="{{processing}}">
          ğŸ“· æ‹å†°ç®±ç…§
        </button>
        <text class="hint">è¯†åˆ«é£Ÿæï¼Œæ¨èå¯åšèœå“</text>
      </view>
      
    </view>
  </view>
</view>